"use strict";(self.webpackChunkfarmersescos_web_portal=self.webpackChunkfarmersescos_web_portal||[]).push([[125],{125:(e,r,t)=>{t.r(r),t.d(r,{default:()=>te});var o=t(9263),s=t(5269),n=t(9978),i=t(3077),a=t(1773),l=t(2996),c=t(7111),d=t(9335),u=t(3514),x=t(4207),h=t(3261),p=t(3513),m=t(8620),A=t(3216),g=t(5475),j=t(1269),f=t(7677),v=t(5043),y=t(7836),b=t(439),w=t(7191),C=t(1036);var O=t(600),P=t(3892),S=t(8331),k=t(5124),z=t(6459),D=t(8656),T=t(7058),R=t(459),L=t(579);function V(e){let{name:r,label:t,defaultOptions:s=!0,getOptions:n,getOptionLabel:i,getOptionValue:a,isMulti:l,placeholder:c,sx:d,...u}=e;const x=(0,R.D)(),[,{value:h,touched:p,error:m},{setValue:A,setTouched:g}]=(0,P.Mt)({name:r,...u}),j=p&&!!m;return(0,L.jsxs)(k.A,{sx:Array.isArray(d)?d:[d],error:j,children:[(0,L.jsx)(z.A,{children:t}),(0,L.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap"},children:(0,L.jsx)(T.A,{isMulti:l,loadOptions:n,defaultOptions:s,value:h,getOptionLabel:i,getOptionValue:a,isClearable:!1,onChange:e=>{g(!0),A(e)},placeholder:c,styles:{container:e=>({...e,display:"inline-block",flexGrow:1}),control:e=>({...e,border:m?`1px solid ${x.palette.danger.outlinedBorder}`:null===e||void 0===e?void 0:e.border})}})}),j&&(0,L.jsx)(D.A,{sx:{fontSize:"sm"},children:m})]})}var q=t(899);const G=q.Ik({name:q.Yj().max(100).required("Product name is required"),description:q.Yj().max(500).required("Description is required"),categories:q.YO().min(1,"Specify atleast one category")});var M=t(4399),Y=t(5847),F=t(6250),_=t(8863),B=t(4021);var I=t(8843);function W(e){let{product:r}=e;const[t,o]=(0,v.useState)(!1),[s,i]=function(){const[e,r]=(0,v.useState)(!1),[t]=(0,j.vM)();return[async function(e,o){const s=structuredClone(o),{categories:n}=s;null!==n&&void 0!==n&&n.length&&(s.categoriesIds=n.map((e=>e.id)),delete s.categories);const{unwrap:i}=t({productId:e,...s});try{r(!0);const e=await i();return C.oR.success("Product updated"),e}catch(a){C.oR.error(`Product update failed. Reason: ${(0,B.A)(a)}`)}finally{r(!1)}},e]}(),[l]=(0,F.c)();return(0,L.jsx)(_.A,{initialValues:{...r},validationSchema:G,onSubmit:async e=>{const t=(0,M.A)(r,e);(0,Y.A)(t)||await s(r.id,t)},onDirty:e=>o(e),children:(0,L.jsxs)(P.lV,{children:[(0,L.jsx)(O.A,{sx:{marginTop:3},name:"name",label:"Product name"}),(0,L.jsx)(V,{sx:{marginTop:2},isMulti:!0,name:"categories",label:"Categories",getOptionLabel:e=>e.name,getOptionValue:e=>e.id,getOptions:(e,r)=>{l().unwrap().then((t=>{let{data:o}=t;r(o.filter((r=>{let{name:t}=r;return t.toLowerCase().includes(e.toLowerCase())})))})).catch((e=>C.oR.error(null===e||void 0===e?void 0:e.message)))}}),(0,L.jsx)(S.A,{sx:{marginTop:2},name:"description",label:"Description"}),(0,L.jsxs)(n.A,{direction:"row",sx:{marginTop:2,width:"100%"},children:[(0,L.jsx)(a.A,{sx:{flexGrow:1},type:"reset",size:"md",variant:"soft",color:"success",disabled:!t||i,children:"Undo Changes"}),(0,L.jsx)(a.A,{size:"md",color:"success",variant:"solid",startDecorator:(0,L.jsx)(I.A,{}),sx:{flexGrow:2,marginLeft:2},type:"submit",disabled:!t||i,loading:i,loadingPosition:"start",children:"Save"})]})]})})}var $=t(7008),E=t(5514),K=t(6755),N=t(6169),U=t(5774),Z=t(7383);const H=q.Ik({recipient:q.Yj().required("Choose the recipients of the promotion").oneOf(["allFarmers","allGroups","selectGroup"]),group:q.gl().when("recipient",{is:"selectGroup",then:e=>e.required("You have to choose a group"),otherwise:e=>e.nullable()}),message:q.Yj().required("A promotion message is required")});var J=t(185),Q=t(5257);function X(e){let{name:r,label:t,options:o,sx:s=[],...n}=e;const[{value:i},{error:a,touched:l},{setValue:c}]=(0,P.Mt)({name:r,...n}),d=l&&!!a;return(0,L.jsxs)(k.A,{sx:Array.isArray(s)?s:[s],error:d,children:[(0,L.jsx)(z.A,{children:t}),(0,L.jsx)(J.A,{...n,name:r,value:i,onChange:e=>{let{target:r}=e;return c(r.value)},children:Object.keys(o).map(((e,r)=>(0,L.jsx)(Q.A,{value:e,label:o[e],variant:"soft",color:"success",size:"sm"},e)))}),(0,L.jsx)(D.A,{sx:{fontSize:"sm"},children:(0,L.jsx)(P.Kw,{name:r})})]})}function ee(e){let{product:r}=e;return(0,L.jsxs)(o.A,{children:[(0,L.jsx)(c.A,{variant:"soft",orientation:"horizontal",sx:{marginBottom:5,overflow:"hidden"},children:(0,L.jsxs)(d.A,{orientation:"horizontal",children:[(0,L.jsx)(u.A,{size:"lg",src:(0,y.A)(r.coverPhoto),children:r.name}),(0,L.jsxs)(o.A,{children:[(0,L.jsx)(l.Ay,{level:"h3",children:(0,b.A)(r.name)}),(0,L.jsx)(o.A,{level:"body-xs",sx:{marginTop:1},children:r.categories.map(((e,r)=>{let{name:t}=e;return(0,L.jsx)(Z.A,{size:"sm",color:"success",sx:{marginRight:1,overflow:"scroll"},children:t},r)}))})]})]})}),(0,L.jsx)(P.l1,{validationSchema:H,initialValues:{recipient:"",group:null,message:""},children:(0,L.jsxs)(P.lV,{children:[(0,L.jsx)(X,{name:"recipient",label:"Send promotion to",options:{allFarmers:"All farmers",allGroups:"Al groups",selectGroup:"Select group"},sx:{marginBottom:2}}),(0,L.jsx)(S.A,{name:"message",label:"Message"}),(0,L.jsx)(a.A,{type:"submit",sx:{marginTop:2,borderRadius:"lg",width:"100%"},color:"success",children:"Promote"})]})})]})}function re(e){let{isOpen:r,onClose:t,product:o}=e;return(0,L.jsx)($.Ay,{open:r,onClose:t,size:"lg",children:(0,L.jsx)(E.A,{children:(0,L.jsxs)(K.A,{sx:{width:500,maxWidth:"95vw"},children:[(0,L.jsx)(N.A,{}),(0,L.jsx)(U.A,{children:"Promote Prouct"}),(0,L.jsx)(ee,{product:o})]})})})}function te(){const{id:e}=(0,A.g)(),[r,t]=(0,v.useState)(null),[O,P,S]=function(){const[e,r]=(0,v.useState)(!1);return[e,function(){r(!0)},function(){r(!1)}]}(),[k,z]=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/products";const[r,t]=(0,v.useState)(!1),o=(0,A.Zp)(),[s]=(0,j.lY)();return[async function(r){const{unwrap:n}=s(r);try{t(!0),await n(),C.oR.success("Product deleted"),o(e)}catch(i){C.oR.error("Product deletion failed")}finally{t(!1)}},r]}(),{data:D,error:T,isFetching:R}=(0,j.tA)(e);return R?(0,L.jsx)(f.A,{}):T?(0,L.jsx)(w.A,{error:T}):D?(0,L.jsxs)(o.A,{sx:{padding:2,marginBottom:3,maxWidth:800,marginLeft:"auto",marginRight:"auto",position:"relative"},children:[(0,L.jsxs)(o.A,{sx:{marginLeft:"auto",marginRight:"auto",maxWidth:500},children:[(0,L.jsx)(s.A,{variant:"plain",children:(0,L.jsx)("img",{src:r||(0,y.A)(D.coverPhoto),alt:D.name})}),(0,L.jsx)(n.A,{spacing:2,direction:"row",sx:{marginTop:2,justifyContent:"center"},children:[D.coverPhoto,D.photo1,D.photo2,D.photo3,D.photo4].map(((e,r)=>(0,L.jsx)(s.A,{sx:{width:100,cursor:"pointer"},children:(0,L.jsx)("img",{src:(0,y.A)(e),alt:D.name,onClick:()=>t((0,y.A)(e))})},r)))}),(0,L.jsxs)(i.A,{variant:"soft",color:"warning",buttonFlex:1,sx:{marginTop:3},children:[(0,L.jsx)(a.A,{disabled:z,loading:z,loadingPosition:"start",startDecorator:(0,L.jsx)(p.A,{}),onClick:async()=>{await k(e)},children:"Delete"}),(0,L.jsx)(a.A,{startDecorator:(0,L.jsx)(m.A,{}),disabled:D.isFeatured,onClick:()=>P(),children:"Promote"})]}),(0,L.jsx)(l.Ay,{level:"h4",sx:{marginTop:3},children:(0,b.A)(D.name)}),(0,L.jsx)(l.Ay,{sx:{marginTop:2},level:"body-md",children:"Sold by"}),(0,L.jsx)(c.A,{children:(0,L.jsxs)(d.A,{orientation:"horizontal",children:[(0,L.jsx)(u.A,{src:(0,y.A)(D.esco.profilePhoto),alt:D.esco.name}),(0,L.jsx)(l.Ay,{level:"body-sm",children:(0,b.A)(D.esco.name)}),(0,L.jsx)(x.Ay,{sx:{marginLeft:"auto"},component:g.N_,to:`/escos/${D.esco.id}`,children:(0,L.jsx)(h.A,{})})]})}),(0,L.jsx)(W,{product:D})]}),(0,L.jsx)(re,{product:D,isOpen:O,onClose:S})]}):void 0}},8863:(e,r,t)=>{t.d(r,{A:()=>a});var o=t(3892),s=t(5043),n=t(579);function i(e){let{onDirty:r,children:t}=e;const{dirty:i}=(0,o.j7)();return(0,s.useEffect)((()=>{r(i)}),[i,r]),(0,n.jsx)(n.Fragment,{children:t})}function a(e){let{children:r,onDirty:t,...s}=e;return(0,n.jsx)(o.l1,{...s,children:(0,n.jsx)(i,{onDirty:t,children:r})})}},4399:(e,r,t)=>{t.d(r,{A:()=>a});const o=t(9159),s=t(67),n=t(6878),{isArray:i}=Array;function a(e,r){return function e(r,t){return o(r,(function(r,o,a){s(o,t[a])||(r[a]=n(o)&&n(t[a])&&!i(o)&&!i(t[a])?e(o,t[a]):o)}))}(r,e)}}}]);
//# sourceMappingURL=125.2b303c8e.chunk.js.map