"use strict";(self.webpackChunkfarmersescos_web_portal=self.webpackChunkfarmersescos_web_portal||[]).push([[956],{7956:(e,r,n)=>{n.r(r),n.d(r,{default:()=>ge});var t=n(9263),o=n(5269),s=n(9978),i=n(3077),a=n(1773),l=n(2996),c=n(7111),d=n(9335),u=n(3514),x=n(4207),h=n(3261),p=n(3513),m=n(8620),A=n(3216),g=n(5475),j=n(1269),f=n(7677),v=n(5043),y=n(7836),b=n(439),w=n(7191),S=n(1036);var P=n(600),C=n(3892),R=n(8331),O=n(5124),L=n(6459),k=n(8656),z=n(7058),D=n(459),T=n(579);function V(e){let{name:r,label:n,defaultOptions:o=!0,getOptions:s,getOptionLabel:i,getOptionValue:a,isMulti:l,placeholder:c,sx:d,...u}=e;const x=(0,D.D)(),[,{value:h,touched:p,error:m},{setValue:A,setTouched:g}]=(0,C.Mt)({name:r,...u}),j=p&&!!m;return(0,T.jsxs)(O.A,{sx:Array.isArray(d)?d:[d],error:j,children:[(0,T.jsx)(L.A,{children:n}),(0,T.jsx)(t.A,{sx:{display:"flex",flexWrap:"wrap"},children:(0,T.jsx)(z.A,{isMulti:l,loadOptions:s,defaultOptions:o,value:h,getOptionLabel:i,getOptionValue:a,isClearable:!1,onChange:e=>{g(!0),A(e)},placeholder:c,styles:{container:e=>({...e,display:"inline-block",flexGrow:1}),control:e=>({...e,border:m?`1px solid ${x.palette.danger.outlinedBorder}`:null===e||void 0===e?void 0:e.border})}})}),j&&(0,T.jsx)(k.A,{sx:{fontSize:"sm"},children:m})]})}var G=n(899);const M=G.Ik({name:G.Yj().max(100).required("Product name is required"),description:G.Yj().max(500).required("Description is required"),categories:G.YO().min(1,"Specify atleast one category")});var F=n(4399),Y=n(5847),_=n(6250),q=n(8863),I=n(4021);var U=n(8843);function $(e){let{product:r}=e;const[n,t]=(0,v.useState)(!1),[o,i]=function(){const[e,r]=(0,v.useState)(!1),[n]=(0,j.vM)();return[async function(e,t){const o=structuredClone(t),{categories:s}=o;null!==s&&void 0!==s&&s.length&&(o.categoriesIds=s.map((e=>e.id)),delete o.categories);const{unwrap:i}=n({productId:e,...o});try{r(!0);const e=await i();return S.oR.success("Product updated"),e}catch(a){S.oR.error(`Product update failed. Reason: ${(0,I.A)(a)}`)}finally{r(!1)}},e]}(),[l]=(0,_.c)();return(0,T.jsx)(q.A,{initialValues:{...r},validationSchema:M,onSubmit:async e=>{const n=(0,F.A)(r,e);(0,Y.A)(n)||await o(r.id,n)},onDirty:e=>t(e),children:(0,T.jsxs)(C.lV,{children:[(0,T.jsx)(P.A,{sx:{marginTop:3},name:"name",label:"Product name"}),(0,T.jsx)(V,{sx:{marginTop:2},isMulti:!0,name:"categories",label:"Categories",getOptionLabel:e=>e.name,getOptionValue:e=>e.id,getOptions:(e,r)=>{l().unwrap().then((n=>{let{data:t}=n;r(t.filter((r=>{let{name:n}=r;return n.toLowerCase().includes(e.toLowerCase())})))})).catch((e=>S.oR.error(null===e||void 0===e?void 0:e.message)))}}),(0,T.jsx)(R.A,{sx:{marginTop:2},name:"description",label:"Description"}),(0,T.jsxs)(s.A,{direction:"row",sx:{marginTop:2,width:"100%"},children:[(0,T.jsx)(a.A,{sx:{flexGrow:1},type:"reset",size:"md",variant:"soft",color:"success",disabled:!n||i,children:"Undo Changes"}),(0,T.jsx)(a.A,{size:"md",color:"success",variant:"solid",startDecorator:(0,T.jsx)(U.A,{}),sx:{flexGrow:2,marginLeft:2},type:"submit",disabled:!n||i,loading:i,loadingPosition:"start",children:"Save"})]})]})})}var B=n(7008),E=n(5514),W=n(6755),N=n(6169),H=n(5774),K=n(7383);const X=G.Ik({recipient:G.Yj().required("Choose the recipients of the promotion").oneOf(["ALL_FARMERS","ALL_GROUPS","GROUP"]),group:G.YO().when("recipient",{is:"selectGroup",then:e=>e.min(1,"You have to choose a group"),otherwise:e=>e.nullable()}),message:G.Yj().required("A promotion message is required")});var Z=n(185),J=n(5257);function Q(e){let{name:r,label:n,options:t,sx:o=[],...s}=e;const[{value:i},{error:a,touched:l},{setValue:c}]=(0,C.Mt)({name:r,...s}),d=l&&!!a;return(0,T.jsxs)(O.A,{sx:Array.isArray(o)?o:[o],error:d,children:[(0,T.jsx)(L.A,{children:n}),(0,T.jsx)(Z.A,{...s,name:r,value:i,onChange:e=>{let{target:r}=e;return c(r.value)},children:Object.keys(t).map(((e,r)=>(0,T.jsx)(J.A,{value:e,label:t[e],variant:"soft",color:"success",size:"sm"},e)))}),(0,T.jsx)(k.A,{sx:{fontSize:"sm"},children:(0,T.jsx)(C.Kw,{name:r})})]})}var ee=n(2608),re=n(1647),ne=n(9402),te=n(5807),oe=n(2168),se=n(8603),ie=n(36),ae=n(6480),le=n(1670),ce=n(8742);const de=(0,oe.A)(se.A)({zIndex:1e3});function ue(e){let{groups:r,isLoading:n,onSelect:o}=e;const i=e=>e===r.length-1;return(0,T.jsx)(t.A,{children:(0,T.jsxs)(s.A,{direction:"column",children:[n&&(0,T.jsx)(f.A,{size:"xs"}),r.map(((e,r)=>(0,T.jsx)(xe,{variant:"soft",sx:{marginBottom:i(r)?0:1,cursor:"pointer"},onSelect:()=>o(e),group:e},r))),!r.length&&(0,T.jsx)(ae.A,{children:"No groups found"})]})})}function xe(e){let{group:r,sx:n=[],onSelect:t}=e;return(0,T.jsx)(c.A,{variant:"soft",sx:Array.isArray(n)?n:[n],onClick:t,children:(0,T.jsxs)(d.A,{orientation:"horizontal",children:[(0,T.jsx)(o.A,{sx:{width:70,flex:"0 0 auto"},children:(0,T.jsx)("img",{src:(0,y.A)(r.profilePhoto),alt:`${r.name}`})}),(0,T.jsx)(l.Ay,{sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},level:"body-sm",children:(0,b.A)(r.name)})]})})}function he(e){let{name:r,label:n,sx:o=[],...s}=e;const i=(0,v.useRef)(!0),[,{value:a,touched:l,error:c},{setValue:d}]=(0,C.Mt)({name:r,...s}),{multiple:u}=s,h=l&&!!c,p=(0,v.useRef)(null),[m,A]=(0,v.useState)([]),[g,j]=(0,v.useState)(!1),[f,y,w]=(0,te.A)({defaultValue:""}),[S,{isFetching:P}]=(0,ce.y$)();function R(){j(!1)}const z=(0,v.useCallback)((()=>a||[]),[a]),D=(0,v.useCallback)((e=>z().find((r=>r.id===e.id))),[z]);return(0,v.useEffect)((()=>{i.current=!0;const{unwrap:e,abort:r}=S({search:f});return e().then((e=>{let{data:n}=e;i.current?A(n.filter((e=>!D(e)))):r()})),()=>i.current=!1}),[f,S,D]),(0,T.jsxs)(O.A,{sx:Array.isArray(o)?o:[o],error:h,children:[(0,T.jsx)(ie.x,{onClickAway:R,children:(0,T.jsxs)(t.A,{children:[(0,T.jsx)(L.A,{children:n}),(0,T.jsx)(ee.Ay,{ref:p,onChange:function(e){let{target:r}=e;w(r.value),j(""!==r.value.trim())},onFocus:function(e){let{target:r}=e;(0,Y.A)(r.value.trim())||(w(r.value),j(!0))},placeholder:"Search groups",value:y,endDecorator:!(0,Y.A)(y)&&(0,T.jsx)(x.Ay,{size:"sm",onClick:function(){w(""),R()},children:(0,T.jsx)(le.A,{})}),...s}),(0,T.jsx)(de,{open:g,anchorEl:p.current,disablePortal:!0,modifiers:[{name:"offset",options:{offset:[0,4]}}],children:(0,T.jsx)(re.A,{sx:{padding:1,maxHeight:350,overflowY:"auto",overflowX:"hidden",width:290},children:(0,T.jsx)(ue,{groups:m,isLoading:P,onSelect:function(e){D(e)||d(u?[...z(),e]:[e])}})})})]})}),h&&(0,T.jsx)(k.A,{children:c}),(0,T.jsx)(t.A,{sx:{marginTop:2},children:z().map(((e,r)=>(0,T.jsx)(K.A,{color:"success",size:"lg",sx:{marginRight:2},endDecorator:(0,T.jsx)(ne.A,{onClick:()=>function(e){D(e)&&d(z().filter((r=>r.id!==e.id)))}(e)}),children:(0,b.A)(e.name)},r)))})]})}function pe(e){let{product:r}=e;const[n,o]=function(){const[e,r]=(0,v.useState)(!1),[n]=(0,j.s$)();return[async function(e,t){const{recipient:o,group:s}=t,i=structuredClone(t);"GROUP"===o&&(i.groupId=s.at(0).id,delete i.group);const{unwrap:a}=n({productId:e,...i});try{r(!0);const e=await a();return S.oR.success("Product promoted"),e}catch(l){S.oR.error(`Product promotion failed. Reason: ${(0,I.A)(l)}`)}finally{r(!1)}},e]}();return(0,T.jsxs)(t.A,{children:[(0,T.jsx)(c.A,{variant:"soft",orientation:"horizontal",sx:{marginBottom:3,overflow:"hidden"},children:(0,T.jsxs)(d.A,{orientation:"horizontal",children:[(0,T.jsx)(u.A,{size:"lg",src:(0,y.A)(r.coverPhoto),children:r.name}),(0,T.jsxs)(t.A,{children:[(0,T.jsx)(l.Ay,{level:"h3",children:(0,b.A)(r.name)}),(0,T.jsx)(t.A,{level:"body-xs",sx:{marginTop:1},children:r.categories.map(((e,r)=>{let{name:n}=e;return(0,T.jsx)(K.A,{size:"sm",color:"success",sx:{marginRight:1,overflow:"scroll"},children:n},r)}))})]})]})}),(0,T.jsx)(C.l1,{validationSchema:X,initialValues:{recipient:"",group:null,message:""},onSubmit:async e=>{await n(r.id,e)},children:(0,T.jsxs)(C.lV,{children:[(0,T.jsx)(Q,{name:"recipient",label:"Send promotion to",options:{ALL_FARMERS:"All farmers",ALL_GROUPS:"All groups",GROUP:"Select group"},sx:{marginBottom:1}}),(0,T.jsx)(me,{}),(0,T.jsx)(R.A,{name:"message",label:"Message",sx:{marginTop:2}}),(0,T.jsx)(a.A,{type:"submit",sx:{marginTop:2,borderRadius:"lg",width:"100%"},color:"success",loadingPosition:"start",loading:o,disabled:o,children:"Promote"})]})})]})}function me(){const{values:{recipient:e}}=(0,C.j7)();return"GROUP"===e?(0,T.jsx)(he,{name:"group",label:""}):(0,T.jsx)(T.Fragment,{})}function Ae(e){let{isOpen:r,onClose:n,product:t}=e;return(0,T.jsx)(B.Ay,{open:r,onClose:n,size:"lg",children:(0,T.jsx)(E.A,{children:(0,T.jsxs)(W.A,{sx:{width:500,maxWidth:"95vw"},children:[(0,T.jsx)(N.A,{}),(0,T.jsx)(H.A,{children:"Promote Prouct"}),(0,T.jsx)(pe,{product:t})]})})})}function ge(){const{id:e}=(0,A.g)(),[r,n]=(0,v.useState)(null),[P,C,R]=function(){const[e,r]=(0,v.useState)(!1);return[e,function(){r(!0)},function(){r(!1)}]}(),[O,L]=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/products";const[r,n]=(0,v.useState)(!1),t=(0,A.Zp)(),[o]=(0,j.lY)();return[async function(r){const{unwrap:s}=o(r);try{n(!0),await s(),S.oR.success("Product deleted"),t(e)}catch(i){S.oR.error("Product deletion failed")}finally{n(!1)}},r]}(),{data:k,error:z,isFetching:D}=(0,j.tA)(e);return D?(0,T.jsx)(f.A,{}):z?(0,T.jsx)(w.A,{error:z}):k?(0,T.jsxs)(t.A,{sx:{padding:2,marginBottom:3,maxWidth:800,marginLeft:"auto",marginRight:"auto",position:"relative"},children:[(0,T.jsxs)(t.A,{sx:{marginLeft:"auto",marginRight:"auto",maxWidth:500},children:[(0,T.jsx)(o.A,{variant:"plain",children:(0,T.jsx)("img",{src:r||(0,y.A)(k.coverPhoto),alt:k.name})}),(0,T.jsx)(s.A,{spacing:2,direction:"row",sx:{marginTop:2,justifyContent:"center"},children:[k.coverPhoto,k.photo1,k.photo2,k.photo3,k.photo4].map(((e,r)=>(0,T.jsx)(o.A,{sx:{width:100,cursor:"pointer"},children:(0,T.jsx)("img",{src:(0,y.A)(e),alt:k.name,onClick:()=>n((0,y.A)(e))})},r)))}),(0,T.jsxs)(i.A,{variant:"soft",color:"warning",buttonFlex:1,sx:{marginTop:3},children:[(0,T.jsx)(a.A,{disabled:L,loading:L,loadingPosition:"start",startDecorator:(0,T.jsx)(p.A,{}),onClick:async()=>{await O(e)},children:"Delete"}),(0,T.jsx)(a.A,{startDecorator:(0,T.jsx)(m.A,{}),disabled:k.isFeatured,onClick:()=>C(),children:"Promote"})]}),(0,T.jsx)(l.Ay,{level:"h4",sx:{marginTop:3},children:(0,b.A)(k.name)}),(0,T.jsx)(l.Ay,{sx:{marginTop:2},level:"body-md",children:"Sold by"}),(0,T.jsx)(c.A,{children:(0,T.jsxs)(d.A,{orientation:"horizontal",children:[(0,T.jsx)(u.A,{src:(0,y.A)(k.esco.profilePhoto),alt:k.esco.name}),(0,T.jsx)(l.Ay,{level:"body-sm",children:(0,b.A)(k.esco.name)}),(0,T.jsx)(x.Ay,{sx:{marginLeft:"auto"},component:g.N_,to:`/escos/${k.esco.id}`,children:(0,T.jsx)(h.A,{})})]})}),(0,T.jsx)($,{product:k})]}),(0,T.jsx)(Ae,{product:k,isOpen:P,onClose:R})]}):void 0}},8863:(e,r,n)=>{n.d(r,{A:()=>a});var t=n(3892),o=n(5043),s=n(579);function i(e){let{onDirty:r,children:n}=e;const{dirty:i}=(0,t.j7)();return(0,o.useEffect)((()=>{r(i)}),[i,r]),(0,s.jsx)(s.Fragment,{children:n})}function a(e){let{children:r,onDirty:n,...o}=e;return(0,s.jsx)(t.l1,{...o,children:(0,s.jsx)(i,{onDirty:n,children:r})})}},4399:(e,r,n)=>{n.d(r,{A:()=>a});const t=n(9159),o=n(67),s=n(6878),{isArray:i}=Array;function a(e,r){return function e(r,n){return t(r,(function(r,t,a){o(t,n[a])||(r[a]=s(t)&&s(n[a])&&!i(t)&&!i(n[a])?e(t,n[a]):t)}))}(r,e)}}}]);
//# sourceMappingURL=956.e84b66b5.chunk.js.map