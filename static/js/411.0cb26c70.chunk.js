"use strict";(self.webpackChunkfarmersescos_web_portal=self.webpackChunkfarmersescos_web_portal||[]).push([[411],{8411:(e,r,t)=>{t.r(r),t.d(r,{default:()=>he});var o=t(9263),s=t(5269),n=t(9978),i=t(3077),a=t(1773),l=t(2996),c=t(7111),d=t(9335),u=t(9344),x=t(4207),h=t(3261),m=t(3513),p=t(8620),g=t(3216),A=t(5475),j=t(1269),f=t(7677),v=t(5043),y=t(7836),b=t(439),w=t(7191),P=t(1036);var R=t(600),O=t(3892),L=t(8331),C=t(5124),S=t(6459),z=t(8656),T=t(7058),k=t(459),M=t(579);function G(e){let{name:r,label:t,defaultOptions:s=!0,getOptions:n,getOptionLabel:i,getOptionValue:a,isMulti:l,placeholder:c,sx:d,...u}=e;const x=(0,k.D)(),[,{value:h,touched:m,error:p},{setValue:g,setTouched:A}]=(0,O.Mt)({name:r,...u}),j=m&&!!p;return(0,M.jsxs)(C.A,{sx:Array.isArray(d)?d:[d],error:j,children:[(0,M.jsx)(S.A,{children:t}),(0,M.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap"},children:(0,M.jsx)(T.A,{isMulti:l,loadOptions:n,defaultOptions:s,value:h,getOptionLabel:i,getOptionValue:a,isClearable:!1,onChange:e=>{A(!0),g(e)},placeholder:c,styles:{container:e=>({...e,display:"inline-block",flexGrow:1}),control:e=>({...e,border:p?`1px solid ${x.palette.danger.outlinedBorder}`:null===e||void 0===e?void 0:e.border})}})}),j&&(0,M.jsx)(z.A,{sx:{fontSize:"sm"},children:p})]})}var I=t(899);const U=I.Ik({name:I.Yj().max(100).required("Product name is required"),description:I.Yj().max(500).required("Description is required"),categories:I.YO().min(1,"Specify atleast one category")});var D=t(4399),V=t(5847),Y=t(6250),_=t(8863),q=t(4021);var F=t(8843);function W(e){let{product:r}=e;const[t,o]=(0,v.useState)(!1),[s,i]=function(){const[e,{isLoading:r}]=(0,j.vM)();return[async function(r,t){const o=structuredClone(t),{categories:s}=o;null!==s&&void 0!==s&&s.length&&(o.categoriesIds=s.map((e=>e.id)),delete o.categories);const{unwrap:n}=e({productId:r,...o});try{const e=await n();return P.oR.success("Product updated"),e}catch(i){P.oR.error(`Product update failed. Reason: ${(0,q.A)(i)}`)}},r]}(),[l]=(0,Y.c)();return(0,M.jsx)(_.A,{initialValues:{...r},validationSchema:U,onSubmit:async e=>{const t=(0,D.A)(r,e);(0,V.A)(t)||await s(r.id,t)},onDirty:e=>o(e),children:(0,M.jsxs)(O.lV,{children:[(0,M.jsx)(R.A,{sx:{marginTop:3},name:"name",label:"Product name"}),(0,M.jsx)(G,{sx:{marginTop:2},isMulti:!0,name:"categories",label:"Categories",getOptionLabel:e=>e.name,getOptionValue:e=>e.id,getOptions:(e,r)=>{l().unwrap().then((t=>{let{data:o}=t;r(o.filter((r=>{let{name:t}=r;return t.toLowerCase().includes(e.toLowerCase())})))})).catch((e=>P.oR.error(null===e||void 0===e?void 0:e.message)))}}),(0,M.jsx)(L.A,{sx:{marginTop:2},name:"description",label:"Description"}),(0,M.jsxs)(n.A,{direction:"row",sx:{marginTop:2,width:"100%"},children:[(0,M.jsx)(a.A,{sx:{flexGrow:1},type:"reset",size:"md",variant:"soft",color:"success",disabled:!t||i,children:"Undo Changes"}),(0,M.jsx)(a.A,{size:"md",color:"success",variant:"solid",startDecorator:(0,M.jsx)(F.A,{}),sx:{flexGrow:2,marginLeft:2},type:"submit",disabled:!t||i,loading:i,loadingPosition:"start",children:"Save"})]})]})})}var $=t(7008),B=t(5514),E=t(6755),N=t(6169),K=t(5774),X=t(7383);const Z=I.Ik({recipient:I.Yj().required("Choose the recipients of the promotion").oneOf(["ALL_FARMERS","ALL_GROUPS","GROUP"]),group:I.YO().when("recipient",{is:"selectGroup",then:e=>e.min(1,"You have to choose a group"),otherwise:e=>e.nullable()}),message:I.Yj().required("A promotion message is required")});var H=t(185),J=t(5257);function Q(e){let{name:r,label:t,options:o,sx:s=[],...n}=e;const[{value:i},{error:a,touched:l},{setValue:c}]=(0,O.Mt)({name:r,...n}),d=l&&!!a;return(0,M.jsxs)(C.A,{sx:Array.isArray(s)?s:[s],error:d,children:[(0,M.jsx)(S.A,{children:t}),(0,M.jsx)(H.A,{...n,name:r,value:i,onChange:e=>{let{target:r}=e;return c(r.value)},children:Object.keys(o).map(((e,r)=>(0,M.jsx)(J.A,{value:e,label:o[e],variant:"soft",color:"success",size:"sm"},e)))}),(0,M.jsx)(z.A,{sx:{fontSize:"sm"},children:(0,M.jsx)(O.Kw,{name:r})})]})}var ee=t(8742),re=t(6318);function te(e){let{name:r,label:t,sx:o=[],...s}=e;const[n]=(0,ee.y$)();return(0,M.jsx)(re.A,{name:r,label:t,fetch:n,sx:o,...s})}function oe(e){let{product:r}=e;const[t,s]=function(){const[e,{isLoading:r}]=(0,j.s$)();return[async function(r,t){const{recipient:o,group:s}=t,n=structuredClone(t);"GROUP"===o&&(n.groupId=s.at(0).id,delete n.group);const{unwrap:i}=e({productId:r,...n});try{const e=await i();return P.oR.success("Product promoted"),e}catch(a){P.oR.error(`Product promotion failed. Reason: ${(0,q.A)(a)}`)}},r]}();return(0,M.jsxs)(o.A,{children:[(0,M.jsx)(c.A,{variant:"soft",orientation:"horizontal",sx:{marginBottom:3,overflow:"hidden"},children:(0,M.jsxs)(d.A,{orientation:"horizontal",children:[(0,M.jsx)(u.A,{size:"lg",src:(0,y.A)(r.coverPhoto),children:r.name}),(0,M.jsxs)(o.A,{children:[(0,M.jsx)(l.Ay,{level:"h3",children:(0,b.A)(r.name)}),(0,M.jsx)(o.A,{level:"body-xs",sx:{marginTop:1},children:r.categories.map(((e,r)=>{let{name:t}=e;return(0,M.jsx)(X.A,{size:"sm",color:"success",sx:{marginRight:1,overflow:"scroll"},children:t},r)}))})]})]})}),(0,M.jsx)(O.l1,{validationSchema:Z,initialValues:{recipient:"",group:null,message:""},onSubmit:async e=>{await t(r.id,e)},children:(0,M.jsxs)(O.lV,{children:[(0,M.jsx)(Q,{name:"recipient",label:"Send promotion to",options:{ALL_FARMERS:"All farmers",ALL_GROUPS:"All groups",GROUP:"Select group"},sx:{marginBottom:1}}),(0,M.jsx)(se,{}),(0,M.jsx)(L.A,{name:"message",label:"Message",sx:{marginTop:2}}),(0,M.jsx)(a.A,{type:"submit",sx:{marginTop:2,borderRadius:"lg",width:"100%"},color:"success",loadingPosition:"start",loading:s,disabled:s,children:"Promote"})]})})]})}function se(){const{values:{recipient:e}}=(0,O.j7)();return"GROUP"===e?(0,M.jsx)(te,{name:"group",label:""}):(0,M.jsx)(M.Fragment,{})}function ne(e){let{isOpen:r,onClose:t,product:o}=e;return(0,M.jsx)($.Ay,{open:r,onClose:t,size:"lg",children:(0,M.jsx)(B.A,{children:(0,M.jsxs)(E.A,{sx:{width:500,maxWidth:"95vw"},children:[(0,M.jsx)(N.A,{}),(0,M.jsx)(K.A,{children:"Promote Prouct"}),(0,M.jsx)(oe,{product:o})]})})})}var ie=t(3510),ae=t(9469),le=t.n(ae),ce=t(1834);function de(e){let{item:r,sx:t=[]}=e;const{videoUrl:s}=r;return(0,M.jsx)(o.A,{sx:[{minWidth:1,maxWidth:1,height:200},{...Array.isArray(t)?t:[t]}],children:(0,M.jsx)(le(),{url:s,width:"100%",height:200})})}function ue(){return(0,M.jsx)(ce.A,{variant:"soft",color:"neutral",sx:{minWidth:1,height:200,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"lg"},children:(0,M.jsxs)(n.A,{direction:"column",sx:{alignItems:"center"},children:[(0,M.jsx)(ie.A,{fontSize:"xl3"}),(0,M.jsx)(l.Ay,{level:"body-sm",children:"No Learning Materials"}),(0,M.jsx)(a.A,{size:"sm",variant:"soft",color:"success",sx:{borderRadius:50,marginTop:1},children:"Upload"})]})})}function xe(e){let{productId:r}=e;const{data:t,isFetching:o,error:s}=(0,j.y6)(r);return o?(0,M.jsx)(f.A,{size:"sm"}):s?(0,M.jsx)(w.A,{error:s}):t.length?(0,M.jsx)(n.A,{direction:"row",spacing:2,sx:{overflowX:"scroll",overflowY:"hidden"},children:t.map((e=>(0,M.jsx)(de,{item:e,sx:{flex:"1 1 auto"}})))}):(0,M.jsx)(ue,{})}function he(){const{id:e}=(0,g.g)(),[r,t]=(0,v.useState)(null),[R,O,L]=function(){const[e,r]=(0,v.useState)(!1);return[e,function(){r(!0)},function(){r(!1)}]}(),[C,S]=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/products";const r=(0,g.Zp)(),[t,{isLoading:o}]=(0,j.lY)();return[async function(o){const{unwrap:s}=t(o);try{await s(),P.oR.success("Product deleted"),r(e)}catch(n){P.oR.error("Product deletion failed")}},o]}(),{data:z,error:T,isFetching:k}=(0,j.tA)(e);return k?(0,M.jsx)(f.A,{}):T?(0,M.jsx)(w.A,{error:T}):z?(0,M.jsxs)(o.A,{sx:{padding:2,marginBottom:3,maxWidth:800,marginLeft:"auto",marginRight:"auto",position:"relative"},children:[(0,M.jsxs)(o.A,{sx:{marginLeft:"auto",marginRight:"auto",maxWidth:500},children:[(0,M.jsx)(s.A,{variant:"plain",children:(0,M.jsx)("img",{src:r||(0,y.A)(z.coverPhoto),alt:z.name})}),(0,M.jsx)(n.A,{spacing:2,direction:"row",sx:{marginTop:2,justifyContent:"center"},children:[z.coverPhoto,z.photo1,z.photo2,z.photo3,z.photo4].map(((e,r)=>(0,M.jsx)(s.A,{sx:{width:100,cursor:"pointer"},children:(0,M.jsx)("img",{src:(0,y.A)(e),alt:z.name,onClick:()=>t((0,y.A)(e))})},r)))}),(0,M.jsxs)(i.A,{variant:"soft",color:"warning",buttonFlex:1,sx:{marginTop:3},children:[(0,M.jsx)(a.A,{disabled:S,loading:S,loadingPosition:"start",startDecorator:(0,M.jsx)(m.A,{}),onClick:async()=>{await C(e)},children:"Delete"}),(0,M.jsx)(a.A,{startDecorator:(0,M.jsx)(p.A,{}),disabled:z.isFeatured,onClick:()=>O(),children:"Promote"}),(0,M.jsx)(a.A,{startDecorator:(0,M.jsx)(ie.A,{}),children:"Upload"})]}),(0,M.jsx)(l.Ay,{level:"h4",sx:{marginTop:3},children:(0,b.A)(z.name)}),(0,M.jsx)(l.Ay,{sx:{marginTop:2},level:"body-md",children:"Sold by"}),(0,M.jsx)(c.A,{children:(0,M.jsxs)(d.A,{orientation:"horizontal",children:[(0,M.jsx)(u.A,{src:(0,y.A)(z.esco.profilePhoto),alt:z.esco.name}),(0,M.jsx)(l.Ay,{level:"body-sm",children:(0,b.A)(z.esco.name)}),(0,M.jsx)(x.Ay,{sx:{marginLeft:"auto"},component:A.N_,to:`/escos/${z.esco.id}`,children:(0,M.jsx)(h.A,{})})]})}),(0,M.jsx)(l.Ay,{level:"body-md",sx:{marginTop:3,marginBottom:1},children:"Learning Materials"}),(0,M.jsx)(xe,{productId:e}),(0,M.jsx)(W,{product:z})]}),(0,M.jsx)(ne,{product:z,isOpen:R,onClose:L})]}):void 0}}}]);
//# sourceMappingURL=411.0cb26c70.chunk.js.map